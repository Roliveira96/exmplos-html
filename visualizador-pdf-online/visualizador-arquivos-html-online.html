<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Visualizador de PDF</title>
    <!-- Inclui Tailwind CSS para estilização fácil e responsiva -->
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        body {
            font-family: 'Inter', sans-serif;
            -webkit-font-smoothing: antialiased;
            -moz-osx-font-smoothing: grayscale;
            background-color: #f0f2f5;
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            padding: 20px;
            box-sizing: border-box;
        }
        .pdf-container {
            width: 100%;
            max-width: 900px;
            background-color: #ffffff;
            border-radius: 12px;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.1);
            overflow: hidden;
            display: flex;
            flex-direction: column;
        }
        canvas {
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.05);
            max-width: 100%;
            height: auto;
            margin: 0 auto;
            display: block; /* Garante que o canvas seja um bloco para centralizar */
        }
    </style>
</head>
<body>
    <div class="pdf-container">
        <div class="p-4 bg-gray-100 border-b border-gray-200 flex justify-between items-center rounded-t-lg">
            <button id="prev-page" class="bg-blue-500 hover:bg-blue-600 text-white font-semibold py-2 px-4 rounded-lg shadow-md transition-all duration-200 disabled:opacity-50 disabled:cursor-not-allowed">
                Página Anterior
            </button>
            <span id="page-info" class="text-gray-700 text-lg font-medium">Página <span id="current-page">0</span> de <span id="total-pages">0</span></span>
            <button id="next-page" class="bg-blue-500 hover:bg-blue-600 text-white font-semibold py-2 px-4 rounded-lg shadow-md transition-all duration-200 disabled:opacity-50 disabled:cursor-not-allowed">
                Próxima Página
            </button>
        </div>

        <div class="p-4 flex-grow flex justify-center items-center">
            <canvas id="pdf-canvas" class="w-full"></canvas>
        </div>

        <div id="loading-message" class="p-4 text-center text-gray-600 text-lg">
            Carregando PDF...
        </div>
        <div id="error-message" class="p-4 text-center text-red-600 text-lg hidden">
            Ocorreu um erro ao carregar o PDF. Por favor, tente novamente.
        </div>
    </div>

    <!-- Inclui a biblioteca PDF.js -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/2.10.377/pdf.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/2.10.377/pdf.worker.min.js"></script>

    <script>
        // Define o caminho para o worker do PDF.js
        pdfjsLib.GlobalWorkerOptions.workerSrc = 'https://cdnjs.cloudflare.com/ajax/libs/pdf.js/2.10.377/pdf.worker.min.js';

        let pdfDoc = null; // Objeto PDF carregado
        let pageNum = 1;   // Página atual
        let pageRendering = false; // Estado de renderização da página
        let pageNumPending = null; // Página pendente para renderização
        const scale = 1.5; // Escala de renderização do PDF

        // Elementos DOM
        const canvas = document.getElementById('pdf-canvas');
        const ctx = canvas.getContext('2d');
        const prevPageBtn = document.getElementById('prev-page');
        const nextPageBtn = document.getElementById('next-page');
        const currentPageSpan = document.getElementById('current-page');
        const totalPagesSpan = document.getElementById('total-pages');
        const loadingMessage = document.getElementById('loading-message');
        const errorMessage = document.getElementById('error-message');

        // URL de um PDF de exemplo (open source do Mozilla)
        const pdfUrl = 'https://mozilla.github.io/pdf.js/web/compressed.tracemonkey-pldi-09.pdf';

        /**
         * Get page info from document, resize canvas accordingly, and render page.
         * @param {number} num Page number.
         */
        async function renderPage(num) {
            pageRendering = true;
            loadingMessage.classList.remove('hidden');
            errorMessage.classList.add('hidden');

            try {
                // Obtém a página do PDF
                const page = await pdfDoc.getPage(num);
                const viewport = page.getViewport({ scale: scale });

                // Define as dimensões do canvas
                canvas.height = viewport.height;
                canvas.width = viewport.width;

                // Renderiza a página no canvas
                const renderContext = {
                    canvasContext: ctx,
                    viewport: viewport
                };
                const renderTask = page.render(renderContext);

                await renderTask.promise;
                pageRendering = false;
                loadingMessage.classList.add('hidden');

                if (pageNumPending !== null) {
                    // Nova renderização está pendente; processa a nova página
                    renderPage(pageNumPending);
                    pageNumPending = null;
                }

                // Atualiza o número da página no display
                currentPageSpan.textContent = pageNum;
                updateNavigationButtons();

            } catch (error) {
                console.error('Erro ao renderizar a página:', error);
                loadingMessage.classList.add('hidden');
                errorMessage.classList.remove('hidden');
            }
        }

        /**
         * If another page rendering in progress, waits until the rendering is finished.
         * Otherwise, executes rendering immediately.
         */
        function queueRenderPage(num) {
            if (pageRendering) {
                pageNumPending = num;
            } else {
                renderPage(num);
            }
        }

        /**
         * Exibe a página anterior.
         */
        function onPrevPage() {
            if (pageNum <= 1) {
                return;
            }
            pageNum--;
            queueRenderPage(pageNum);
        }

        /**
         * Exibe a próxima página.
         */
        function onNextPage() {
            if (pageNum >= pdfDoc.numPages) {
                return;
            }
            pageNum++;
            queueRenderPage(pageNum);
        }

        // Adiciona os event listeners para os botões
        prevPageBtn.addEventListener('click', onPrevPage);
        nextPageBtn.addEventListener('click', onNextPage);

        /**
         * Atualiza o estado dos botões de navegação.
         */
        function updateNavigationButtons() {
            prevPageBtn.disabled = pageNum <= 1;
            nextPageBtn.disabled = pageNum >= pdfDoc.numPages;
        }

        /**
         * Carrega o documento PDF.
         */
        async function loadPdf() {
            loadingMessage.classList.remove('hidden');
            errorMessage.classList.add('hidden');

            try {
                const loadingTask = pdfjsLib.getDocument(pdfUrl);
                pdfDoc = await loadingTask.promise;

                // Exibe o total de páginas
                totalPagesSpan.textContent = pdfDoc.numPages;

                // Renderiza a primeira página
                renderPage(pageNum);
            } catch (error) {
                console.error('Erro ao carregar o PDF:', error);
                loadingMessage.classList.add('hidden');
                errorMessage.classList.remove('hidden');
            }
        }

        // Carrega o PDF quando a página é carregada
        window.onload = loadPdf;
    </script>
</body>
</html>
