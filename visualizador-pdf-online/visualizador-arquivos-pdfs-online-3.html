<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Visualizador de PDF com Efeito de Livro</title>
    
    <!-- Inclui o Tailwind CSS para estilização dos botões e layout -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- Inclui jQuery, que é uma dependência do Turn.js -->
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    
    <!-- Inclui a biblioteca Turn.js para o efeito de virar a página -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/turn.js/3/turn.min.js"></script>
    
    <!-- Inclui a biblioteca PDF.js para carregar e renderizar o PDF -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/2.10.377/pdf.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/2.10.377/pdf.worker.min.js"></script>

    <style>
        body {
            font-family: 'Inter', sans-serif;
            background-color: #d1d5db; /* Um cinza mais escuro para destacar o livro */
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            overflow: hidden;
            padding: 1rem;
        }
        #flipbook-container {
            perspective: 2000px;
        }
        #flipbook {
            width: 90vw;
            height: 90vh;
            max-width: 1200px;
            max-height: 800px;
        }
        #flipbook .page {
            background-color: white;
            box-shadow: 0 0 20px rgba(0,0,0,0.2);
            display: flex;
            justify-content: center;
            align-items: center;
        }
        #flipbook .page canvas {
            max-width: 100%;
            max-height: 100%;
            height: auto;
            width: auto;
        }
        /* Sombras para dar profundidade ao virar a página */
        #flipbook .shadow {
            transition: shadow 0.5s ease;
        }
        #loading-message {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            z-index: 1000;
        }
    </style>
</head>
<body>
    <div id="loading-message" class="bg-white p-4 rounded-lg shadow-xl text-lg text-gray-700">
        Carregando e renderizando as páginas do livro...
    </div>

    <!-- Container do Livro -->
    <div id="flipbook-container">
        <div id="flipbook"></div>
    </div>

    <!-- Controles de Navegação -->
    <div class="mt-4 flex items-center space-x-4">
        <button id="prev-page" class="bg-blue-600 hover:bg-blue-700 text-white font-bold py-2 px-5 rounded-lg shadow-md transition-transform transform hover:scale-105">
            Anterior
        </button>
        <span id="page-info" class="text-gray-800 font-semibold"></span>
        <button id="next-page" class="bg-blue-600 hover:bg-blue-700 text-white font-bold py-2 px-5 rounded-lg shadow-md transition-transform transform hover:scale-105">
            Próxima
        </button>
    </div>

    <script>
        pdfjsLib.GlobalWorkerOptions.workerSrc = 'https://cdnjs.cloudflare.com/ajax/libs/pdf.js/2.10.377/pdf.worker.min.js';
        const pdfUrl = 'https://mozilla.github.io/pdf.js/web/compressed.tracemonkey-pldi-09.pdf';
        const scale = 1.5;

        const flipbook = $('#flipbook');
        const loadingMessage = $('#loading-message');
        const pageInfo = $('#page-info');
        let isFlipbookInitialized = false; // Variável de controlo

        async function loadPdfAndInitFlipbook() {
            try {
                const loadingTask = pdfjsLib.getDocument(pdfUrl);
                const pdfDoc = await loadingTask.promise;
                const numPages = pdfDoc.numPages;

                // Renderiza todas as páginas antes de inicializar o flipbook
                for (let pageNum = 1; pageNum <= numPages; pageNum++) {
                    const page = await pdfDoc.getPage(pageNum);
                    const viewport = page.getViewport({ scale: scale });
                    
                    const canvas = document.createElement('canvas');
                    const ctx = canvas.getContext('2d');
                    canvas.height = viewport.height;
                    canvas.width = viewport.width;

                    const renderContext = {
                        canvasContext: ctx,
                        viewport: viewport
                    };
                    await page.render(renderContext).promise;
                    
                    const pageElement = $('<div>').addClass('page').append(canvas);
                    flipbook.append(pageElement);
                }

                // Esconde a mensagem de carregamento
                loadingMessage.hide();

                // Inicializa o Turn.js
                flipbook.turn({
                    width: flipbook.width(),
                    height: flipbook.height(),
                    autoCenter: true,
                    elevation: 50,
                    gradients: true,
                    when: {
                        turned: function(event, page, view) {
                            updatePageInfo();
                        }
                    }
                });
                
                isFlipbookInitialized = true; // Marca o livro como inicializado
                updatePageInfo();

            } catch (error) {
                console.error('Erro ao carregar o PDF:', error);
                loadingMessage.text('Falha ao carregar o PDF.');
            }
        }
        
        function updatePageInfo() {
            if (!isFlipbookInitialized) return;
            const currentPage = flipbook.turn('page');
            const totalPages = flipbook.turn('pages');
            pageInfo.text(`Página ${currentPage} de ${totalPages}`);
        }

        $('#prev-page').on('click', () => {
            flipbook.turn('previous');
        });

        $('#next-page').on('click', () => {
            flipbook.turn('next');
        });
        
        // Ajusta o tamanho do flipbook se a janela for redimensionada
        $(window).on('resize', function() {
            // Apenas executa se o flipbook já tiver sido inicializado
            if (isFlipbookInitialized) {
                flipbook.turn('size', flipbook.width(), flipbook.height());
            }
        });

        $(document).ready(function() {
            loadPdfAndInitFlipbook();
        });
    </script>
</body>
</html>
