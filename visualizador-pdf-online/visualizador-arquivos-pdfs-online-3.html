<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Visualizador de PDF com Efeito de Livro</title>
    
    <!-- Inclui o Tailwind CSS para estilização dos botões e layout -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- Inclui jQuery, que é uma dependência do Turn.js -->
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    
    <!-- Inclui a biblioteca Turn.js para o efeito de virar a página -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/turn.js/3/turn.min.js"></script>
    
    <!-- Inclui a biblioteca PDF.js para carregar e renderizar o PDF -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/2.10.377/pdf.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/2.10.377/pdf.worker.min.js"></script>

    <style>
        body {
            font-family: 'Inter', sans-serif;
            background-color: #d1d5db; /* Um cinza mais escuro para destacar o livro */
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            overflow: hidden;
            padding: 1rem;
        }
        #flipbook-container {
            perspective: 2000px;
        }
        #flipbook {
            width: 90vw;
            height: 90vh;
            max-width: 1200px;
            max-height: 800px;
        }
        #flipbook .page {
            background-color: white;
            box-shadow: 0 0 20px rgba(0,0,0,0.2);
            display: flex;
            justify-content: center;
            align-items: center;
        }
        #flipbook .page canvas {
            max-width: 100%;
            max-height: 100%;
            height: auto;
            width: auto;
        }
        #loading-message {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            z-index: 1000;
        }
        #zoom-content {
            cursor: grab;
        }
        #zoom-content.grabbing {
            cursor: grabbing;
        }
    </style>
</head>
<body>
    <div id="loading-message" class="bg-white p-4 rounded-lg shadow-xl text-lg text-gray-700">
        Carregando e renderizando as páginas do livro...
    </div>

    <!-- Container do Livro -->
    <div id="flipbook-container">
        <div id="flipbook"></div>
    </div>

    <!-- Controles de Navegação -->
    <div class="mt-4 flex items-center space-x-4 z-10">
        <button id="prev-page" class="bg-blue-600 hover:bg-blue-700 text-white font-bold py-2 px-5 rounded-lg shadow-md transition-transform transform hover:scale-105">Anterior</button>
        <span id="page-info" class="text-gray-800 font-semibold"></span>
        <button id="next-page" class="bg-blue-600 hover:bg-blue-700 text-white font-bold py-2 px-5 rounded-lg shadow-md transition-transform transform hover:scale-105">Próxima</button>
        <button id="zoom-btn" class="bg-gray-600 hover:bg-gray-700 text-white font-bold py-2 px-5 rounded-lg shadow-md transition-transform transform hover:scale-105">Lupa</button>
    </div>

    <!-- Modal de Zoom -->
    <div id="zoom-modal" class="fixed inset-0 bg-black bg-opacity-75 hidden items-center justify-center p-4 z-50">
        <div id="zoom-content" class="bg-white p-2 rounded-lg shadow-2xl max-w-full max-h-full overflow-auto">
            <!-- O canvas com zoom será inserido aqui -->
        </div>
        <div class="absolute top-4 right-4 flex items-center space-x-2">
            <button id="zoom-out-modal" class="bg-white text-gray-800 rounded-full py-1 px-3 text-2xl leading-none shadow-lg hover:bg-gray-200">-</button>
            <button id="zoom-in-modal" class="bg-white text-gray-800 rounded-full py-1 px-3 text-2xl leading-none shadow-lg hover:bg-gray-200">+</button>
            <button id="close-zoom" class="bg-white text-gray-800 rounded-full py-1 px-3 text-2xl leading-none shadow-lg hover:bg-gray-200">&times;</button>
        </div>
    </div>

    <script>
        pdfjsLib.GlobalWorkerOptions.workerSrc = 'https://cdnjs.cloudflare.com/ajax/libs/pdf.js/2.10.377/pdf.worker.min.js';
        const pdfUrl = 'https://mozilla.github.io/pdf.js/web/compressed.tracemonkey-pldi-09.pdf';
        const scale = 1.5;

        const flipbook = $('#flipbook');
        const loadingMessage = $('#loading-message');
        const pageInfo = $('#page-info');
        
        let isFlipbookInitialized = false;
        let pdfDoc = null;
        let modalZoomLevel = 1.5; // Nível de zoom inicial da lupa

        async function loadPdfAndInitFlipbook() {
            try {
                const loadingTask = pdfjsLib.getDocument(pdfUrl);
                pdfDoc = await loadingTask.promise;
                const numPages = pdfDoc.numPages;

                for (let pageNum = 1; pageNum <= numPages; pageNum++) {
                    const page = await pdfDoc.getPage(pageNum);
                    const viewport = page.getViewport({ scale: scale });
                    const canvas = document.createElement('canvas');
                    const ctx = canvas.getContext('2d');
                    canvas.height = viewport.height;
                    canvas.width = viewport.width;
                    const renderContext = { canvasContext: ctx, viewport: viewport };
                    await page.render(renderContext).promise;
                    const pageElement = $('<div>').addClass('page').append(canvas);
                    flipbook.append(pageElement);
                }

                loadingMessage.hide();

                flipbook.turn({
                    width: flipbook.width(), height: flipbook.height(),
                    autoCenter: true, elevation: 50, gradients: true,
                    when: { turned: (event, page, view) => updatePageInfo() }
                });
                
                isFlipbookInitialized = true;
                updatePageInfo();
            } catch (error) {
                console.error('Erro ao carregar o PDF:', error);
                loadingMessage.text('Falha ao carregar o PDF.');
            }
        }
        
        function updatePageInfo() {
            if (!isFlipbookInitialized) return;
            const currentPage = flipbook.turn('page');
            const totalPages = flipbook.turn('pages');
            pageInfo.text(`Página ${currentPage} de ${totalPages}`);
        }

        $('#prev-page').on('click', () => flipbook.turn('previous'));
        $('#next-page').on('click', () => flipbook.turn('next'));
        $(window).on('resize', () => { if (isFlipbookInitialized) flipbook.turn('size', flipbook.width(), flipbook.height()); });

        // --- LÓGICA DO ZOOM ---
        const zoomBtn = $('#zoom-btn');
        const zoomModal = $('#zoom-modal');
        const zoomContent = $('#zoom-content');
        const closeZoomBtn = $('#close-zoom');

        async function renderZoomedPages(zoomLevel) {
            if (!isFlipbookInitialized || !pdfDoc) return;
            zoomContent.empty();
            const view = flipbook.turn('view');
            
            try {
                loadingMessage.text('A aplicar zoom...').show();
                const canvasContainer = $('<div class="flex flex-col md:flex-row gap-2"></div>');
                for (const pageNum of view) {
                    if (pageNum === 0) continue;
                    const page = await pdfDoc.getPage(pageNum);
                    const viewport = page.getViewport({ scale: zoomLevel });
                    const canvas = document.createElement('canvas');
                    const ctx = canvas.getContext('2d');
                    canvas.height = viewport.height;
                    canvas.width = viewport.width;
                    const renderContext = { canvasContext: ctx, viewport: viewport };
                    await page.render(renderContext).promise;
                    canvasContainer.append(canvas);
                }
                zoomContent.append(canvasContainer);
                loadingMessage.hide().text('Carregando e renderizando as páginas do livro...');
            } catch (error) {
                console.error("Erro ao aplicar zoom:", error);
                loadingMessage.text('Falha ao aplicar zoom.').show().delay(2000).fadeOut();
            }
        }

        zoomBtn.on('click', () => {
            renderZoomedPages(modalZoomLevel);
            zoomModal.removeClass('hidden').addClass('flex');
        });

        $('#zoom-in-modal').on('click', () => {
            modalZoomLevel = Math.min(5.0, modalZoomLevel + 0.5); // Limite máximo de zoom
            renderZoomedPages(modalZoomLevel);
        });

        $('#zoom-out-modal').on('click', () => {
            modalZoomLevel = Math.max(1.0, modalZoomLevel - 0.5); // Limite mínimo de zoom
            renderZoomedPages(modalZoomLevel);
        });

        closeZoomBtn.on('click', () => {
            zoomModal.addClass('hidden').removeClass('flex');
            zoomContent.empty();
        });

        // --- LÓGICA DE ARRASTAR (PAN) ---
        let isPanning = false;
        let startX, startY, scrollLeft, scrollTop;

        zoomContent.on('mousedown', (e) => {
            isPanning = true;
            zoomContent.addClass('grabbing');
            startX = e.pageX - zoomContent.offset().left;
            startY = e.pageY - zoomContent.offset().top;
            scrollLeft = zoomContent.scrollLeft();
            scrollTop = zoomContent.scrollTop();
        });

        zoomContent.on('mouseleave', () => {
            isPanning = false;
            zoomContent.removeClass('grabbing');
        });

        zoomContent.on('mouseup', () => {
            isPanning = false;
            zoomContent.removeClass('grabbing');
        });

        zoomContent.on('mousemove', (e) => {
            if (!isPanning) return;
            e.preventDefault();
            const x = e.pageX - zoomContent.offset().left;
            const y = e.pageY - zoomContent.offset().top;
            const walkX = (x - startX);
            const walkY = (y - startY);
            zoomContent.scrollLeft(scrollLeft - walkX);
            zoomContent.scrollTop(scrollTop - walkY);
        });

        $(document).ready(loadPdfAndInitFlipbook);
    </script>
</body>
</html>
